<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>$pageTitle</title>
    <meta name="author" content="Argan Wang">

    <style type="text/css">
      #fromJar { float: right; width: 300px; height: 50px; border: 1px solid #999;background: #ccc; font-size:16px}
      #libJars { float: right; width: 300px; height: 100px; border: 1px solid #999; font-size:16px}
      #btnSubmit {float:right}
      .classfile .itm { color:#666; font-size: 70%; font-weight: normal; }
      .classfile .itm::after { content:"/"; color:#bbb; }
      .classfile .itm:last-child { color:#000; font-size: 100%; font-weight: bold; }
      .classfile .itm:last-child::after { content:""; }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="/static/css/jquery.treeview.css" type="text/css" />
    <script type="text/javascript" src="/static/js/jquery.min.1.7.1.js"></script>
    <script type="text/javascript" src="/static/js/jquery.jeditable-1.7.2.js"></script>
    <script type="text/javascript" src="/static/js/jquery.treeview-1.4.1.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap-tab.js"></script>
    <script type="text/javascript" src="/static/js/jquery-ui.min-1.8.9.js"></script>
    <script type="text/javascript" src="/static/js/jquery.floatinglayer.min.js"></script>
    
    <!-- Include required JS files -->
	<script type="text/javascript" src="/static/js/sh/shCore.js"></script>
	 
	<script type="text/javascript" src="/static/js/sh/shBrushJava.js"></script>
	 
	<!-- Include *at least* the core style and default theme -->
	<link href="/static/css/sh/shCore.css" rel="stylesheet" type="text/css" />
	<link href="/static/css/sh/shThemeDefault.css" rel="stylesheet" type="text/css" />

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <script>
      var jarId="$id";
      var jarVersion="0";
      var pkgNodes = {};
      var pkgRootNode = null;
      function makePkgNode(package) {
      	var idx = package.lastIndexOf("/");
      	var parent, shortName;
      	if (idx == -1) {
      		parent = pkgRootNode;
      		shortName = package;
        } else {
      		var parentPkgName = package.substring(0, idx);
      		parent = pkgNodes[parentPkgName];
          if (!parent) parent = makePkgNode(parentPkgName);
          shortName = package.substring(idx+1);
        }
        var $li = $("<li class=\"package closed\" data-pkgname=\""+package+"\"><span class=\"folder \">"+shortName+"</span>\n" +
                "              <ul></ul></li>");
        $li.appendTo(parent);
        return pkgNodes[package] = $li.find("ul");
      }
      function onLoadFiletree(res) {
          var method="cfrsource";
          console.log("onLoadFiletree");
          console.log("class count:",res.classes.length);
          var ftc = $("#filetreeContainer");
          localStorage['jar_'+jarId+'_classes'] = JSON.stringify(res);
          ftc.html('<ul id="jar" class="filetree">\n' +
                  '    <li><span class="folder">'+res.jarName+'</span>\n' +
                  '         <ul></ul></li>' +
                  '</ul>')
          pkgRootNode = ftc.find('ul ul');

          for(var i=0; i<res.classes.length; i++) {
              var cls = res.classes[i];
              //console.log(i, cls);
              if (!pkgNodes[cls.package]) {
                  makePkgNode(cls.package);
              }
              var clsName = cls.package+"/"+cls.shortName;
              pkgNodes[cls.package].append("<li class=\"file\" data-classname=\""+clsName+"\">" +
                        "<a href=\"/jarviewer/"+method+".htm?id="+res.jarId+"&clz="+clsName+"\" title=\""+cls.shortName+"\">" +
                        cls.shortName+"</a></li>")
          }
          //localStorage['jar_'+jarId+'_version'] = jarVersion;

          $("#jar").treeview();
          $("#treeFilter").on("change",function() {
              var filter = this.value;
              localStorage.treeFilterValue=filter;
              $("#jar .package").each(function() {
                $(this).toggle ($(this).find("span").text().indexOf(filter)!==-1);
              });
          }).val(localStorage.treeFilterValue||"").change();
      }
      
      $(document).ready(function() {
          var ftc = $("#filetreeContainer");
          if (ftc.length>0) {
            if (localStorage['jar_'+jarId+'_classes']) {
              onLoadFiletree(JSON.parse(localStorage['jar_'+jarId+'_classes']));
            } else {
              $.get("/jarviewer/filetree.json?id="+jarId, onLoadFiletree, "json");
            }
          }
      })
    </script>
  </head>